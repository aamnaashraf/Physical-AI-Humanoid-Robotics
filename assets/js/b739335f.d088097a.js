"use strict";(globalThis.webpackChunkphysical_ai_humanoid_robotics_textbook=globalThis.webpackChunkphysical_ai_humanoid_robotics_textbook||[]).push([[793],{3570:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"module-1-ros2/chapter-2-nodes-topics","title":"Chapter 2: ROS 2 Nodes and Topics","description":"Master rclpy programming by building publishers, subscribers, and understanding Quality of Service for reliable robot communication","source":"@site/docs/module-1-ros2/chapter-2-nodes-topics.mdx","sourceDirName":"module-1-ros2","slug":"/module-1-ros2/chapter-2-nodes-topics","permalink":"/Physical-AI-Humanoid-Robotics/docs/module-1-ros2/chapter-2-nodes-topics","draft":false,"unlisted":false,"editUrl":"https://github.com/aamnaashraf/Physical-AI-Humanoid-Robotics/edit/main/docs/module-1-ros2/chapter-2-nodes-topics.mdx","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"Chapter 2: ROS 2 Nodes and Topics","description":"Master rclpy programming by building publishers, subscribers, and understanding Quality of Service for reliable robot communication","keywords":["rclpy","ROS 2 nodes","publishers","subscribers","topics","QoS","Quality of Service","callbacks"],"sidebar_position":2,"learning_objectives":["Implement ROS 2 nodes using rclpy library and the Node class","Create publishers and subscribers to exchange messages between nodes","Apply Quality of Service (QoS) policies to configure reliable communication","Demonstrate debugging skills using ROS 2 introspection tools"],"prerequisites":["Chapter 1: Introduction to ROS 2","Python 3.10+","Basic OOP concepts"],"estimated_time":90,"content_type":"tutorial","difficulty":"beginner","ros2_distribution":"humble","chapter_number":2},"sidebar":"tutorialSidebar","previous":{"title":"Chapter 1: Introduction to ROS 2","permalink":"/Physical-AI-Humanoid-Robotics/docs/module-1-ros2/chapter-1-intro-ros2"},"next":{"title":"Chapter 3: Services, Actions, and Parameters","permalink":"/Physical-AI-Humanoid-Robotics/docs/module-1-ros2/chapter-3-services-actions-parameters"}}');var i=n(4848),t=n(8453);const o={title:"Chapter 2: ROS 2 Nodes and Topics",description:"Master rclpy programming by building publishers, subscribers, and understanding Quality of Service for reliable robot communication",keywords:["rclpy","ROS 2 nodes","publishers","subscribers","topics","QoS","Quality of Service","callbacks"],sidebar_position:2,learning_objectives:["Implement ROS 2 nodes using rclpy library and the Node class","Create publishers and subscribers to exchange messages between nodes","Apply Quality of Service (QoS) policies to configure reliable communication","Demonstrate debugging skills using ROS 2 introspection tools"],prerequisites:["Chapter 1: Introduction to ROS 2","Python 3.10+","Basic OOP concepts"],estimated_time:90,content_type:"tutorial",difficulty:"beginner",ros2_distribution:"humble",chapter_number:2},l="Chapter 2: ROS 2 Nodes and Topics",c={},a=[{value:"2.1 Understanding Nodes",id:"21-understanding-nodes",level:2},{value:"2.1.1 Basic Node Structure",id:"211-basic-node-structure",level:3},{value:"2.1.2 Node Lifecycle",id:"212-node-lifecycle",level:3},{value:"2.2 Publisher/Subscriber Pattern",id:"22-publishersubscriber-pattern",level:2},{value:"2.2.1 Creating a Publisher",id:"221-creating-a-publisher",level:3},{value:"2.2.2 Creating a Subscriber",id:"222-creating-a-subscriber",level:3},{value:"2.2.3 Communication Flow",id:"223-communication-flow",level:3},{value:"2.3 Quality of Service (QoS)",id:"23-quality-of-service-qos",level:2},{value:"2.3.1 QoS Policies",id:"231-qos-policies",level:3},{value:"2.3.2 Using QoS Profiles",id:"232-using-qos-profiles",level:3},{value:"2.3.3 Predefined QoS Profiles",id:"233-predefined-qos-profiles",level:3},{value:"2.4 Introspection Tools",id:"24-introspection-tools",level:2},{value:"2.4.1 Node Introspection",id:"241-node-introspection",level:3},{value:"2.4.2 Topic Introspection",id:"242-topic-introspection",level:3},{value:"2.4.3 Debugging Communication Issues",id:"243-debugging-communication-issues",level:3},{value:"2.5 Hands-On Exercise: Build a Temperature Monitor",id:"25-hands-on-exercise-build-a-temperature-monitor",level:2},{value:"Problem Statement",id:"problem-statement",level:3},{value:"Requirements",id:"requirements",level:3},{value:"Testing",id:"testing",level:3},{value:"Deliverable",id:"deliverable",level:3},{value:"Key Takeaways",id:"key-takeaways",level:2},{value:"\u2713 Core Concepts Mastered",id:"-core-concepts-mastered",level:3},{value:"What&#39;s Next?",id:"whats-next",level:2}];function d(e){const s={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components},{CodeExample:n,ConceptCallout:r,ExerciseBlock:o}=s;return n||p("CodeExample",!0),r||p("ConceptCallout",!0),o||p("ExerciseBlock",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.header,{children:(0,i.jsx)(s.h1,{id:"chapter-2-ros-2-nodes-and-topics",children:"Chapter 2: ROS 2 Nodes and Topics"})}),"\n",(0,i.jsxs)(s.p,{children:["Welcome to hands-on ROS 2 programming! In Chapter 1, you learned the conceptual foundations\u2014nodes, topics, services, and the computational graph. Now you'll write Python code using ",(0,i.jsx)(s.strong,{children:"rclpy"})," (ROS Client Library for Python) to create nodes that communicate via topics."]}),"\n",(0,i.jsx)(s.p,{children:"By the end of this chapter, you'll build a temperature monitoring system with a sensor node publishing data and a monitor node subscribing to it\u2014your first multi-node ROS 2 application."}),"\n",(0,i.jsx)(s.h2,{id:"21-understanding-nodes",children:"2.1 Understanding Nodes"}),"\n",(0,i.jsx)(s.p,{children:"Every ROS 2 application starts with nodes. A node is a process that performs computation\u2014reading sensors, processing data, controlling motors, etc."}),"\n",(0,i.jsxs)(r,{type:"definition",title:"What is rclpy?",children:[(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"rclpy"})," is the official Python client library for ROS 2. It provides:"]}),(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Node class"}),": Base class for creating ROS 2 nodes"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Communication primitives"}),": Publishers, subscribers, services, actions"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Lifecycle management"}),": Initialization, spinning, shutdown"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Utilities"}),": Logging, time management, parameter handling"]}),"\n"]}),(0,i.jsx)(s.p,{children:"Think of rclpy as the Python API for interacting with the ROS 2 middleware (DDS)."})]}),"\n",(0,i.jsx)(s.h3,{id:"211-basic-node-structure",children:"2.1.1 Basic Node Structure"}),"\n",(0,i.jsx)(s.p,{children:"Every rclpy node follows this pattern:"}),"\n",(0,i.jsx)(n,{language:"python",filename:"minimal_node.py",difficulty:"beginner",children:"import rclpy\nfrom rclpy.node import Node\n\nclass MinimalNode(Node):\n  def __init__(self):\n      super().__init__('minimal_node')  # Node name\n      self.get_logger().info('Minimal node has been started')\n\ndef main(args=None):\n  rclpy.init(args=args)  # Initialize ROS 2 communication\n  node = MinimalNode()\n  rclpy.spin(node)  # Keep node alive\n  node.destroy_node()\n  rclpy.shutdown()  # Cleanup\n\nif __name__ == '__main__':\n  main()\n"}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Key Components Explained:"})}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:(0,i.jsx)(s.code,{children:"rclpy.init()"})}),": Initializes the ROS 2 client library. Must be called before creating nodes."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsxs)(s.strong,{children:[(0,i.jsx)(s.code,{children:"Node"})," class"]}),": Base class providing all ROS 2 functionality. Pass a unique node name to ",(0,i.jsx)(s.code,{children:"super().__init__()"}),"."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:(0,i.jsx)(s.code,{children:"rclpy.spin()"})}),": Blocks and processes callbacks (subscriptions, timers, services). Without this, your node exits immediately."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsxs)(s.strong,{children:[(0,i.jsx)(s.code,{children:"destroy_node()"})," / ",(0,i.jsx)(s.code,{children:"shutdown()"})]}),": Clean up resources when the node exits."]}),"\n"]}),"\n",(0,i.jsx)(r,{type:"tip",title:"Node Names Must Be Unique",children:(0,i.jsxs)(s.p,{children:["Each node in a ROS 2 system must have a unique name. If you launch two nodes with the same name, the newer one will cause a naming conflict. Use descriptive names like ",(0,i.jsx)(s.code,{children:"camera_driver"}),", ",(0,i.jsx)(s.code,{children:"perception_node"}),", ",(0,i.jsx)(s.code,{children:"motor_controller"}),"."]})}),"\n",(0,i.jsx)(s.h3,{id:"212-node-lifecycle",children:"2.1.2 Node Lifecycle"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-mermaid",children:"stateDiagram-v2\r\n    [*] --\x3e Unconfigured: rclpy.init()\r\n    Unconfigured --\x3e Active: Node.__init__()\r\n    Active --\x3e Active: rclpy.spin() (processing callbacks)\r\n    Active --\x3e Shutdown: Ctrl+C / destroy_node()\r\n    Shutdown --\x3e [*]: rclpy.shutdown()\n"})}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Lifecycle States:"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Unconfigured"}),": ROS 2 initialized, but no nodes created yet"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Active"}),": Node running, processing callbacks (subscriptions, timers, services)"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Shutdown"}),": Node destroyed, resources released"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"22-publishersubscriber-pattern",children:"2.2 Publisher/Subscriber Pattern"}),"\n",(0,i.jsxs)(s.p,{children:["The ",(0,i.jsx)(s.strong,{children:"publish-subscribe"})," pattern is the most common ROS 2 communication method for streaming data (sensor readings, robot state, commands)."]}),"\n",(0,i.jsx)(s.h3,{id:"221-creating-a-publisher",children:"2.2.1 Creating a Publisher"}),"\n",(0,i.jsxs)(s.p,{children:["A ",(0,i.jsx)(s.strong,{children:"publisher"})," sends messages to a topic at regular intervals."]}),"\n",(0,i.jsx)(n,{language:"python",filename:"temperature_publisher.py",difficulty:"beginner",estimatedTime:15,children:"import rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import Float32\n\nclass TemperaturePublisher(Node):\n  def __init__(self):\n      super().__init__('temperature_publisher')\n\n      # Create publisher: message type Float32, topic '/temperature', queue size 10\n      self.publisher_ = self.create_publisher(Float32, 'temperature', 10)\n\n      # Create timer: call timer_callback every 1.0 seconds\n      self.timer = self.create_timer(1.0, self.timer_callback)\n\n      self.temperature = 20.0  # Simulated temperature in Celsius\n      self.get_logger().info('Temperature Publisher started')\n\n  def timer_callback(self):\n      msg = Float32()\n      msg.data = self.temperature\n\n      self.publisher_.publish(msg)\n      self.get_logger().info(f'Publishing temperature: {msg.data:.2f}\xb0C')\n\n      # Simulate temperature fluctuation\n      self.temperature += 0.5\n\ndef main(args=None):\n  rclpy.init(args=args)\n  node = TemperaturePublisher()\n  rclpy.spin(node)\n  node.destroy_node()\n  rclpy.shutdown()\n\nif __name__ == '__main__':\n  main()\n"}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Publisher API Breakdown:"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:"self.publisher_ = self.create_publisher(\r\n    msg_type=Float32,          # Message type (from std_msgs.msg)\r\n    topic='temperature',       # Topic name\r\n    qos_profile=10             # Queue size (or QoSProfile object)\r\n)\n"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:(0,i.jsx)(s.code,{children:"msg_type"})}),": The message type (e.g., ",(0,i.jsx)(s.code,{children:"Float32"}),", ",(0,i.jsx)(s.code,{children:"String"}),", ",(0,i.jsx)(s.code,{children:"Twist"}),"). Subscribers must use the same type."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:(0,i.jsx)(s.code,{children:"topic"})}),": Topic name (string). Conventionally uses lowercase with underscores."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:(0,i.jsx)(s.code,{children:"qos_profile"})}),": Integer (queue size) or ",(0,i.jsx)(s.code,{children:"QoSProfile"})," object (covered in Section 2.3)."]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Timer for Periodic Publishing:"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:"self.timer = self.create_timer(\r\n    timer_period_sec=1.0,      # Publish every 1 second\r\n    callback=self.timer_callback  # Function to call\r\n)\n"})}),"\n",(0,i.jsx)(s.p,{children:"Timers are essential for periodic tasks like sensor sampling or control loops."}),"\n",(0,i.jsx)(s.h3,{id:"222-creating-a-subscriber",children:"2.2.2 Creating a Subscriber"}),"\n",(0,i.jsxs)(s.p,{children:["A ",(0,i.jsx)(s.strong,{children:"subscriber"})," receives messages from a topic and processes them in a callback function."]}),"\n",(0,i.jsx)(n,{language:"python",filename:"temperature_subscriber.py",difficulty:"beginner",estimatedTime:15,children:"import rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import Float32\n\nclass TemperatureSubscriber(Node):\n  def __init__(self):\n      super().__init__('temperature_subscriber')\n\n      # Create subscriber: message type Float32, topic '/temperature', callback function\n      self.subscription = self.create_subscription(\n          Float32,\n          'temperature',\n          self.listener_callback,\n          10  # Queue size\n      )\n\n      self.get_logger().info('Temperature Subscriber started')\n\n  def listener_callback(self, msg):\n      \"\"\"Called every time a message is received\"\"\"\n      self.get_logger().info(f'Received temperature: {msg.data:.2f}\xb0C')\n\n      # Add temperature warning logic\n      if msg.data > 30.0:\n          self.get_logger().warn(f'HIGH TEMPERATURE ALERT: {msg.data:.2f}\xb0C')\n\ndef main(args=None):\n  rclpy.init(args=args)\n  node = TemperatureSubscriber()\n  rclpy.spin(node)\n  node.destroy_node()\n  rclpy.shutdown()\n\nif __name__ == '__main__':\n  main()\n"}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Subscriber API Breakdown:"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:"self.subscription = self.create_subscription(\r\n    msg_type=Float32,               # Must match publisher's message type\r\n    topic='temperature',            # Must match publisher's topic name\r\n    callback=self.listener_callback,  # Function to call when message arrives\r\n    qos_profile=10                  # Queue size (or QoSProfile object)\r\n)\n"})}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Callback Function Signature:"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:"def listener_callback(self, msg):\r\n    # msg is an instance of Float32 (or whatever msg_type you specified)\r\n    temperature_value = msg.data\r\n    # Process the message...\n"})}),"\n",(0,i.jsx)(s.p,{children:"Callbacks execute asynchronously whenever a message arrives. Keep them short (< 10ms) to avoid blocking other callbacks."}),"\n",(0,i.jsx)(s.h3,{id:"223-communication-flow",children:"2.2.3 Communication Flow"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-mermaid",children:"sequenceDiagram\r\n    participant Timer\r\n    participant Publisher as Temperature<br/>Publisher\r\n    participant Topic as /temperature<br/>(DDS Topic)\r\n    participant Subscriber as Temperature<br/>Subscriber\r\n\r\n    loop Every 1 second\r\n        Timer->>Publisher: timer_callback()\r\n        Publisher->>Publisher: Create Float32 msg\r\n        Publisher->>Topic: publish(msg)\r\n        Topic->>Subscriber: listener_callback(msg)\r\n        Subscriber->>Subscriber: Log temperature\r\n        Subscriber->>Subscriber: Check threshold\r\n    end\r\n\r\n    Note over Publisher,Subscriber: Asynchronous, non-blocking\n"})}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Running the Example:"})}),"\n",(0,i.jsx)(s.p,{children:"Open two terminals and source ROS 2:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"# Terminal 1: Run publisher\r\nsource /opt/ros/humble/setup.bash\r\npython3 temperature_publisher.py\r\n\r\n# Terminal 2: Run subscriber\r\nsource /opt/ros/humble/setup.bash\r\npython3 temperature_subscriber.py\n"})}),"\n",(0,i.jsx)(s.p,{children:"You'll see the publisher logging temperatures and the subscriber receiving them in real-time."}),"\n",(0,i.jsx)(s.h2,{id:"23-quality-of-service-qos",children:"2.3 Quality of Service (QoS)"}),"\n",(0,i.jsxs)(s.p,{children:["Quality of Service (QoS) policies control ",(0,i.jsx)(s.strong,{children:"how"})," messages are delivered between publishers and subscribers. This is critical for robotics where some data (sensor readings) can be dropped, but other data (safety commands) must be guaranteed."]}),"\n",(0,i.jsxs)(r,{type:"concept",title:"Why QoS Matters in Robotics",children:[(0,i.jsx)(s.p,{children:"Different data streams have different requirements:"}),(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Camera images (30 FPS)"}),': Dropping occasional frames is acceptable. Use "best effort" delivery.']}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Safety stop commands"}),': Must be delivered reliably. Use "reliable" delivery with retransmission.']}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Sensor data"}),': Latest value is most important. Use "keep last" with history depth 1.']}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Log messages"}),': All messages matter. Use "reliable" with larger history depth.']}),"\n"]}),(0,i.jsx)(s.p,{children:"QoS lets you optimize for latency, bandwidth, and reliability based on your application's needs."})]}),"\n",(0,i.jsx)(s.h3,{id:"231-qos-policies",children:"2.3.1 QoS Policies"}),"\n",(0,i.jsx)(s.p,{children:"ROS 2 uses DDS QoS policies. The most important ones are:"}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Policy"}),(0,i.jsx)(s.th,{children:"Options"}),(0,i.jsx)(s.th,{children:"Use Case"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.strong,{children:"Reliability"})}),(0,i.jsxs)(s.td,{children:[(0,i.jsx)(s.code,{children:"RELIABLE"}),", ",(0,i.jsx)(s.code,{children:"BEST_EFFORT"})]}),(0,i.jsx)(s.td,{children:"Reliable: retransmit lost packets (e.g., commands). Best-effort: no retries (e.g., high-frequency sensor data)"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.strong,{children:"Durability"})}),(0,i.jsxs)(s.td,{children:[(0,i.jsx)(s.code,{children:"TRANSIENT_LOCAL"}),", ",(0,i.jsx)(s.code,{children:"VOLATILE"})]}),(0,i.jsx)(s.td,{children:"Transient: new subscribers get last message. Volatile: only get messages after subscription"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.strong,{children:"History"})}),(0,i.jsxs)(s.td,{children:[(0,i.jsx)(s.code,{children:"KEEP_LAST(n)"}),", ",(0,i.jsx)(s.code,{children:"KEEP_ALL"})]}),(0,i.jsx)(s.td,{children:"Keep last N messages or all messages in queue"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.strong,{children:"Deadline"})}),(0,i.jsx)(s.td,{children:"Time duration"}),(0,i.jsx)(s.td,{children:"Expect messages within deadline (e.g., 100ms). Trigger callback if missed"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.strong,{children:"Lifespan"})}),(0,i.jsx)(s.td,{children:"Time duration"}),(0,i.jsx)(s.td,{children:"Messages expire after lifespan (e.g., 1 second old commands ignored)"})]})]})]}),"\n",(0,i.jsx)(s.h3,{id:"232-using-qos-profiles",children:"2.3.2 Using QoS Profiles"}),"\n",(0,i.jsx)(n,{language:"python",filename:"qos_example.py",difficulty:"intermediate",children:"import rclpy\nfrom rclpy.node import Node\nfrom rclpy.qos import QoSProfile, ReliabilityPolicy, HistoryPolicy, DurabilityPolicy\nfrom std_msgs.msg import String\n\nclass QoSExampleNode(Node):\n  def __init__(self):\n      super().__init__('qos_example_node')\n\n      # Create custom QoS profile for sensor data\n      sensor_qos = QoSProfile(\n          reliability=ReliabilityPolicy.BEST_EFFORT,  # Don't retransmit\n          history=HistoryPolicy.KEEP_LAST,            # Keep only latest message\n          depth=1,                                     # Queue size 1\n          durability=DurabilityPolicy.VOLATILE        # Don't persist for late subscribers\n      )\n\n      # Create custom QoS profile for commands (reliable delivery)\n      command_qos = QoSProfile(\n          reliability=ReliabilityPolicy.RELIABLE,     # Retransmit until ACK\n          history=HistoryPolicy.KEEP_LAST,\n          depth=10,                                    # Buffer up to 10 commands\n          durability=DurabilityPolicy.TRANSIENT_LOCAL  # Late subscribers get last message\n      )\n\n      # Publishers with different QoS\n      self.sensor_pub = self.create_publisher(String, 'sensor_data', sensor_qos)\n      self.command_pub = self.create_publisher(String, 'commands', command_qos)\n\n      self.get_logger().info('QoS Example Node started')\n\ndef main(args=None):\n  rclpy.init(args=args)\n  node = QoSExampleNode()\n  rclpy.spin(node)\n  node.destroy_node()\n  rclpy.shutdown()\n\nif __name__ == '__main__':\n  main()\n"}),"\n",(0,i.jsxs)(r,{type:"warning",title:"QoS Compatibility",children:[(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Publishers and subscribers must have compatible QoS profiles to communicate!"})}),(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"RELIABLE"})," publisher \u2194\ufe0f ",(0,i.jsx)(s.code,{children:"RELIABLE"})," subscriber \u2705"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"BEST_EFFORT"})," publisher \u2194\ufe0f ",(0,i.jsx)(s.code,{children:"BEST_EFFORT"})," subscriber \u2705"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"RELIABLE"})," publisher \u2194\ufe0f ",(0,i.jsx)(s.code,{children:"BEST_EFFORT"})," subscriber \u2705"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"BEST_EFFORT"})," publisher \u2194\ufe0f ",(0,i.jsx)(s.code,{children:"RELIABLE"})," subscriber \u274c (no connection)"]}),"\n"]}),(0,i.jsxs)(s.p,{children:["If messages aren't flowing, use ",(0,i.jsx)(s.code,{children:"ros2 topic info /topic_name --verbose"})," to check QoS compatibility."]})]}),"\n",(0,i.jsx)(s.h3,{id:"233-predefined-qos-profiles",children:"2.3.3 Predefined QoS Profiles"}),"\n",(0,i.jsx)(s.p,{children:"ROS 2 provides common presets:"}),"\n",(0,i.jsx)(n,{language:"python",showLineNumbers:!1,children:"from rclpy.qos import qos_profile_sensor_data, qos_profile_system_default\n\n# Use sensor data preset (best-effort, keep last 1)\nself.sensor_pub = self.create_publisher(\n  Image,\n  'camera/image',\n  qos_profile_sensor_data\n)\n\n# Use system default preset (reliable, keep last 10)\nself.command_pub = self.create_publisher(\n  Twist,\n  'cmd_vel',\n  qos_profile_system_default\n)\n"}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Common Presets:"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"qos_profile_sensor_data"}),": Best-effort, keep last 5, volatile"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"qos_profile_system_default"}),": Reliable, keep last 10, volatile"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"qos_profile_services_default"}),": Reliable, keep last 10, volatile"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"qos_profile_parameters"}),": Reliable, keep last 1000, transient local"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"24-introspection-tools",children:"2.4 Introspection Tools"}),"\n",(0,i.jsx)(s.p,{children:"ROS 2 provides powerful CLI tools to inspect running systems without modifying code."}),"\n",(0,i.jsx)(s.h3,{id:"241-node-introspection",children:"2.4.1 Node Introspection"}),"\n",(0,i.jsx)(n,{language:"bash",showLineNumbers:!1,children:"# List all active nodes\nros2 node list\n\n# Get detailed info about a node\nros2 node info /temperature_publisher\n\n# Output:\n# /temperature_publisher\n#   Subscribers:\n#     /parameter_events: rcl_interfaces/msg/ParameterEvent\n#   Publishers:\n#     /temperature: std_msgs/msg/Float32\n#     /rosout: rcl_interfaces/msg/Log\n#   Service Servers:\n#     /temperature_publisher/describe_parameters: rcl_interfaces/srv/DescribeParameters\n#   Service Clients:\n#   Action Servers:\n#   Action Clients:\n"}),"\n",(0,i.jsx)(s.h3,{id:"242-topic-introspection",children:"2.4.2 Topic Introspection"}),"\n",(0,i.jsx)(n,{language:"bash",showLineNumbers:!1,children:'# List all active topics\nros2 topic list\n\n# Get topic type\nros2 topic type /temperature\n# Output: std_msgs/msg/Float32\n\n# Get detailed topic info (publishers, subscribers, QoS)\nros2 topic info /temperature --verbose\n\n# Echo messages in real-time\nros2 topic echo /temperature\n\n# Measure publishing frequency\nros2 topic hz /temperature\n\n# Publish a message from command line\nros2 topic pub /temperature std_msgs/msg/Float32 "{data: 25.5}"\n'}),"\n",(0,i.jsx)(s.h3,{id:"243-debugging-communication-issues",children:"2.4.3 Debugging Communication Issues"}),"\n",(0,i.jsxs)(r,{type:"tip",title:"Common Debugging Workflow",children:[(0,i.jsx)(s.p,{children:"When nodes don't communicate:"}),(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Verify both nodes are running"}),": ",(0,i.jsx)(s.code,{children:"ros2 node list"})]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Check topic names match"}),": ",(0,i.jsx)(s.code,{children:"ros2 topic list"})," (typos are common!)"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Verify message types match"}),": ",(0,i.jsx)(s.code,{children:"ros2 topic info /topic_name"})]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Check QoS compatibility"}),": ",(0,i.jsx)(s.code,{children:"ros2 topic info /topic_name --verbose"})]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Echo the topic"}),": ",(0,i.jsx)(s.code,{children:"ros2 topic echo /topic_name"})," (are messages flowing?)"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Check frequency"}),": ",(0,i.jsx)(s.code,{children:"ros2 topic hz /topic_name"})," (is rate correct?)"]}),"\n"]})]}),"\n",(0,i.jsx)(s.h2,{id:"25-hands-on-exercise-build-a-temperature-monitor",children:"2.5 Hands-On Exercise: Build a Temperature Monitor"}),"\n",(0,i.jsxs)(o,{title:"Temperature Monitoring System",difficulty:"beginner",estimatedTime:30,objectives:["Create a publisher node that simulates temperature sensor readings","Create a subscriber node that monitors temperature and logs warnings","Use ROS 2 CLI tools to inspect the system and verify message flow","Experiment with QoS policies to understand reliability settings"],hints:["Use create_timer() with 0.5 second period for faster updates","Add random temperature fluctuations using Python's random module","Log warnings when temperature exceeds 30\xb0C or drops below 10\xb0C","Try changing QoS from RELIABLE to BEST_EFFORT and observe behavior"],children:[(0,i.jsx)(s.h3,{id:"problem-statement",children:"Problem Statement"}),(0,i.jsx)(s.p,{children:"You are building a temperature monitoring system for a robotics lab. The system has:"}),(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Sensor Node"}),": Simulates a temperature sensor that publishes readings every 0.5 seconds"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Monitor Node"}),": Subscribes to temperature data and logs warnings for extreme values"]}),"\n"]}),(0,i.jsx)(s.h3,{id:"requirements",children:"Requirements"}),(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Temperature Sensor Node"})," (",(0,i.jsx)(s.code,{children:"temperature_sensor.py"}),"):"]}),(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Publish to ",(0,i.jsx)(s.code,{children:"/lab/temperature"})," topic (type: ",(0,i.jsx)(s.code,{children:"std_msgs/msg/Float32"}),")"]}),"\n",(0,i.jsx)(s.li,{children:"Initial temperature: 22.0\xb0C"}),"\n",(0,i.jsxs)(s.li,{children:["Add random fluctuation: ",(0,i.jsx)(s.code,{children:"random.uniform(-1.0, 1.0)"})," degrees per reading"]}),"\n",(0,i.jsx)(s.li,{children:"Log each published temperature"}),"\n",(0,i.jsx)(s.li,{children:"Use QoS: Reliable, Keep Last 10"}),"\n"]}),(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Temperature Monitor Node"})," (",(0,i.jsx)(s.code,{children:"temperature_monitor.py"}),"):"]}),(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Subscribe to ",(0,i.jsx)(s.code,{children:"/lab/temperature"})," topic"]}),"\n",(0,i.jsx)(s.li,{children:"Log all received temperatures"}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Warn"}),' if temperature > 30\xb0C: "HIGH TEMPERATURE ALERT"']}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Warn"}),' if temperature < 10\xb0C: "LOW TEMPERATURE ALERT"']}),"\n",(0,i.jsx)(s.li,{children:"Use QoS: Reliable, Keep Last 10"}),"\n"]}),(0,i.jsx)(s.h3,{id:"testing",children:"Testing"}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"# Terminal 1: Run sensor\r\npython3 temperature_sensor.py\r\n\r\n# Terminal 2: Run monitor\r\npython3 temperature_monitor.py\r\n\r\n# Terminal 3: Inspect system\r\nros2 node list\r\nros2 topic list\r\nros2 topic info /lab/temperature\r\nros2 topic echo /lab/temperature\r\nros2 topic hz /lab/temperature\r\n\r\n# Expected: ~2 Hz (0.5 second period)\n"})}),(0,i.jsx)(s.h3,{id:"deliverable",children:"Deliverable"}),(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:["Two working Python files: ",(0,i.jsx)(s.code,{children:"temperature_sensor.py"})," and ",(0,i.jsx)(s.code,{children:"temperature_monitor.py"})]}),"\n",(0,i.jsx)(s.li,{children:"Screenshot of both nodes running with temperature warnings appearing"}),"\n",(0,i.jsx)(s.li,{children:"Answer: What happens when you kill the sensor node? (Monitor stops receiving messages, but doesn't crash)"}),"\n",(0,i.jsxs)(s.li,{children:["Answer: What happens when you change sensor to ",(0,i.jsx)(s.code,{children:"BEST_EFFORT"})," and monitor to ",(0,i.jsx)(s.code,{children:"RELIABLE"}),"? (No communication - QoS mismatch)"]}),"\n"]})]}),"\n",(0,i.jsx)(s.h2,{id:"key-takeaways",children:"Key Takeaways"}),"\n",(0,i.jsxs)("div",{className:"key-takeaways",children:[(0,i.jsx)(s.h3,{id:"-core-concepts-mastered",children:"\u2713 Core Concepts Mastered"}),(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"rclpy provides the Python API for ROS 2"})," with the Node class as the foundation for all node implementations"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Publishers send messages to topics"})," using ",(0,i.jsx)(s.code,{children:"create_publisher()"})," and timers for periodic publishing"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Subscribers receive messages from topics"})," using ",(0,i.jsx)(s.code,{children:"create_subscription()"})," with callback functions for asynchronous processing"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Quality of Service (QoS) policies control message delivery"})," with reliability (reliable vs. best-effort), durability (volatile vs. transient), and history (keep last N) settings"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"QoS compatibility matters"}),": Publishers and subscribers must have compatible QoS profiles (e.g., BEST_EFFORT publisher cannot connect to RELIABLE subscriber)"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"ROS 2 CLI tools enable debugging"})," with ",(0,i.jsx)(s.code,{children:"ros2 node list/info"}),", ",(0,i.jsx)(s.code,{children:"ros2 topic list/echo/hz/info"})," for inspecting running systems"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Node lifecycle follows init \u2192 spin \u2192 shutdown"})," with ",(0,i.jsx)(s.code,{children:"rclpy.init()"}),", ",(0,i.jsx)(s.code,{children:"rclpy.spin()"}),", and ",(0,i.jsx)(s.code,{children:"rclpy.shutdown()"})]}),"\n"]})]}),"\n",(0,i.jsx)(s.h2,{id:"whats-next",children:"What's Next?"}),"\n",(0,i.jsxs)(s.p,{children:["In ",(0,i.jsx)(s.strong,{children:"Chapter 3: Python and rclpy Deep Dive"}),", you'll learn advanced rclpy patterns:"]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Service clients and servers for request-response communication"}),"\n",(0,i.jsx)(s.li,{children:"Action servers for long-running tasks with feedback"}),"\n",(0,i.jsx)(s.li,{children:"Parameters for runtime configuration"}),"\n",(0,i.jsx)(s.li,{children:"Callback groups for managing concurrent execution"}),"\n",(0,i.jsx)(s.li,{children:"Integration patterns for AI agents (bridging AI logic with ROS nodes)"}),"\n"]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Prerequisite Check"}),": Before proceeding, ensure you can:"]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"\u2705 Create a publisher node that sends messages at a fixed rate"}),"\n",(0,i.jsx)(s.li,{children:"\u2705 Create a subscriber node that processes messages in a callback"}),"\n",(0,i.jsx)(s.li,{children:"\u2705 Explain the difference between RELIABLE and BEST_EFFORT QoS"}),"\n",(0,i.jsxs)(s.li,{children:["\u2705 Use ",(0,i.jsx)(s.code,{children:"ros2 topic echo"})," and ",(0,i.jsx)(s.code,{children:"ros2 topic hz"})," to debug communication"]}),"\n"]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Next"}),": Chapter 3: Python and rclpy Deep Dive (coming soon)"]})]})}function h(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}function p(e,s){throw new Error("Expected "+(s?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},8453:(e,s,n)=>{n.d(s,{R:()=>o,x:()=>l});var r=n(6540);const i={},t=r.createContext(i);function o(e){const s=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(t.Provider,{value:s},e.children)}}}]);